{% extends "base.html" %} {% block content %}
<section class="cart-page">
  <div class="cart-header">
    <div>
      <h2>Tu Carrito</h2>
      <p class="cart-subtitle">
        Revisa tus productos antes de continuar al pago.
      </p>
    </div>
    <a href="{{ url_for('main.index') }}" class="btn btn-outline"
      >Seguir comprando</a
    >
  </div>

  {% if cart and cart['items'] %}
  <div class="cart-grid">
    <div class="cart-list">
      {% for item in cart['items'] %}
      <article class="cart-item">
        <div class="cart-item-media">
          <img
            src="{{ item['product'].image_url or 'https://placehold.co/90x90' }}"
            alt="{{ item['product'].name }}"
          />
          <div>
            <a
              href="{{ url_for('main.product_detail', id=item['product'].id) }}"
            >
              {{ item['product'].name }}
            </a>
            <span class="cart-item-price">RD$ {{ item['product'].price }}</span>
          </div>
        </div>
        <div class="cart-item-actions">
          <form
            action="{{ url_for('cart.update_item', item_id=item.id) }}"
            method="POST"
            class="cart-qty"
            data-auto-submit="true"
          >
            <label>Cantidad</label>
            <input
              type="number"
              name="quantity"
              value="{{ item.quantity }}"
              min="1"
              class="form-control"
            />
          </form>
          <div class="cart-item-total">
            <span>Total</span>
            <strong>RD$ {{ item['product'].price * item.quantity }}</strong>
          </div>
          <form
            action="{{ url_for('cart.remove_item', item_id=item.id) }}"
            method="POST"
          >
            <button type="submit" class="btn btn-danger" title="Eliminar">
              <i class="fas fa-trash"></i>
            </button>
          </form>
        </div>
      </article>
      {% endfor %}
    </div>

    <aside class="cart-summary">
      <h3>Resumen</h3>
      <div class="cart-summary-row">
        <span>Subtotal</span>
        <span>RD$ {{ total }}</span>
      </div>
      <div class="cart-summary-row">
        <span>Envío</span>
        <span>Calculado en checkout</span>
      </div>
      <div class="cart-summary-total">
        <span>Total</span>
        <strong>RD$ {{ total }}</strong>
      </div>
      <a href="{{ url_for('cart.checkout') }}" class="btn btn-success btn-lg"
        >Proceder al pago</a
      >
    </aside>
  </div>
  {% else %}
  <div class="cart-empty">
    <i class="fas fa-shopping-basket"></i>
    <h3>Tu carrito está vacío</h3>
    <p>Agrega productos para verlos aquí.</p>
    <a href="{{ url_for('main.index') }}" class="btn btn-primary"
      >Ir a comprar</a
    >
  </div>
  {% endif %}
</section>
{% endblock %}
