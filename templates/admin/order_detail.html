{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-between align-center mb-4">
    <h2>Gestionar Orden #{{ order.id }}</h2>
    <a href="{{ url_for('admin.orders_list') }}" class="btn btn-secondary">Volver</a>
</div>

<div class="d-flex" style="gap: 2rem;">
    <div style="flex: 2;">
        <div class="card" style="background: white; padding: 2rem; border-radius: 8px;">
            <h3>Items del Pedido</h3>
            <table class="table mt-2">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Cant</th>
                        <th>Precio</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items %}
                    <tr>
                        <td>{{ item.product_name }}</td>
                        <td>{{ item.quantity }}</td>
                        <td>${{ item.price_at_purchase }}</td>
                        <td>${{ item.price_at_purchase * item.quantity }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" class="text-right"><strong>Total</strong></td>
                        <td><strong>${{ order.total_amount }}</strong></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <div style="flex: 1;">
        <div class="card" style="background: white; padding: 2rem; border-radius: 8px;">
            <h3>Estado del Pedido</h3>
            <p><strong>Cliente:</strong> {{ order.user.email if order.user else 'Desconocido' }}</p>
            <p><strong>Fecha:</strong> {{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</p>

            <form method="POST" class="mt-4">
                <div class="form-group">
                    <label class="form-label">Cambiar Estado</label>
                    <select name="status" class="form-control">
                        <option value="pending" {% if order.status=='pending' %}selected{% endif %}>Pendiente</option>
                        <option value="completed" {% if order.status=='completed' %}selected{% endif %}>Completado
                        </option>
                        <option value="cancelled" {% if order.status=='cancelled' %}selected{% endif %}>Cancelado
                        </option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Actualizar</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}