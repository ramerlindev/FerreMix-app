{% extends "base.html" %}

{% block content %}
<div class="d-flex" style="gap: 2rem;">
    <!-- Filters Sidebar -->
    <aside class="filters" style="width: 250px; flex-shrink: 0;">
        <h3>Filtros</h3>
        <form action="{{ url_for('main.offers') if 'offers' in request.path else url_for('main.index') }}" method="GET">
            <div class="filter-group">
                <label class="form-label">Buscar</label>
                <input type="text" name="search" class="form-control" placeholder="Nombre..."
                    value="{{ request.args.get('search', '') }}">
            </div>

            <div class="filter-group">
                <label class="form-label">Categoría</label>
                <select name="category" class="form-control">
                    <option value="">Todas</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {% if request.args.get('category')|int==category.id %}selected{%
                        endif %}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="filter-group">
                <label class="form-label">Precio Mínimo</label>
                <input type="number" name="min_price" class="form-control"
                    value="{{ request.args.get('min_price', '') }}">
            </div>

            <div class="filter-group">
                <label class="form-label">Precio Máximo</label>
                <input type="number" name="max_price" class="form-control"
                    value="{{ request.args.get('max_price', '') }}">
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%;">Filtrar</button>
            <a href="{{ url_for('main.index') }}" class="btn btn-secondary mt-2"
                style="width: 100%; text-align: center;">Limpiar</a>
        </form>
    </aside>

    <!-- Product Grid -->
    <main style="flex-grow: 1;">
        <h2>{{ title or 'Nuestros Productos' }}</h2>

        {% if products %}
        <div class="product-grid">
            {% for product in products %}
            <div class="product-card">
                <img src="{{ product.image_url or 'https://placehold.co/300x200' }}" alt="{{ product.name }}"
                    class="product-image">
                <div class="product-details">
                    {% if product.is_offer %}
                    <span class="badge-offer">OFERTA</span>
                    {% endif %}
                    <div class="product-category">{{ product.category.name if product.category else 'General' }}</div>
                    <h3 class="product-title">{{ product.name }}</h3>
                    <div class="product-price">${{ product.price }}</div>

                    <div class="d-flex gap-2 mt-auto">
                        <a href="{{ url_for('main.product_detail', id=product.id) }}" class="btn btn-outline"
                            style="flex: 1; text-align: center;">Ver</a>
                        <form action="{{ url_for('cart.add_to_cart', product_id=product.id) }}" method="POST"
                            style="flex: 1;">
                            <button type="submit" class="btn btn-primary" style="width: 100%;">
                                <i class="fas fa-cart-plus"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info">No se encontraron productos con los filtros seleccionados.</div>
        {% endif %}
    </main>
</div>
{% endblock %}